{% extends "base.html" %}
{% block title %}基本変形実行モード{% endblock %}

{% block content %}
<h2>現在の行列</h2>
<div>$$ {{ latex_result | safe }} $$</div>

<hr>
<h3>次の基本変形を指定：</h3>
<form method="POST">
    <div>
        <label fro="operation">操作タイプ：</label>
        <select name="operation", id="operation">
            <option value="scale">定数倍</option>
            <option value="add">加える</option>
            <option value="swap">入れ替える</option>
        </select>
    </div>

  <div>
    <label for="target">対象行：</label>
    <input type="number" name="target" id="target"
      min="{{ 1 if config.ONE_INDEXED else 0 }}" required placeholder="行番号">
  </div>

  <div id="factor-div">
    <label for="factor">係数：</label>
    <input type="text" name="factor" id="factor" value="1" placeholder="例：2, 1/3, -√2">
  </div>

  <div id="other-div">
    <label for="other">相手の行：</label>
    <input type="number" name="other" id="other"
      min="{{ 1 if config.ONE_INDEXED else 0 }}" placeholder="行番号">
  </div>

    <br>
    <button type="submit">変形を実行</button>
</form>

<hr>
<h3>変形履歴：</h3>
<ul>
    {% for step in history %}
    <li>{{ step }}</li>
    {% endfor %}
</ul>

<br>
<a href="{{ url_for("select_size") }}">最初に戻る</a>

<script>
document.getElementById("operation").addEventListener("change", function () {
  const op = this.value;
  const factorDiv = document.getElementById("factor-div");
  const otherDiv = document.getElementById("other-div");

  if (op === "scale") {
    factorDiv.style.display = "block";
    otherDiv.style.display = "none";
  } else if (op === "add") {
    factorDiv.style.display = "block";
    otherDiv.style.display = "block";
  } else if (op === "swap") {
    factorDiv.style.display = "none";
    otherDiv.style.display = "block";
  }
});

// 初期化時にも実行（ページリロード後の状態対応）
document.getElementById("operation").dispatchEvent(new Event("change"));
</script>

{% endblock %}